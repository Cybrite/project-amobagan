# Weekly Todo System

## Overview

The Weekly Todo System is a new implementation that replaces the previous diet plan system with a more actionable, todo-based approach. Users get personalized weekly todo lists generated by Gemini AI based on their health goals and preferences.

## Key Features

### 1. Weekly Todo Generation

-   **One-time Generation**: Weekly todos are generated once and saved to the database
-   **Personalized Content**: Based on user's health goals, dietary preferences, and workout frequency
-   **Structured Format**: Daily todos organized by categories (meal, workout, health, lifestyle)

### 2. Daily Task Management

-   **Actionable Tasks**: Specific, checkable items like "Swap white rice with quinoa"
-   **Category Organization**: Tasks grouped into meal, workout, health, and lifestyle
-   **Priority Levels**: High, medium, low priority tasks
-   **Timing**: Morning, afternoon, evening, or anytime tasks
-   **Simple Structure**: Just 1 focused task per category per day (4 total per day)

### 3. Progress Tracking

-   **Completion Status**: Mark individual tasks as complete/incomplete
-   **Real-time Updates**: Completion rates updated automatically
-   **Daily Progress**: Track completion for each day
-   **Weekly Overview**: Overall completion rate for the week

### 4. Weekly Analysis

-   **Performance Review**: Analysis of completed weeks
-   **Category Statistics**: Breakdown by meal, workout, health, lifestyle
-   **Goal Progress**: Track progress towards weekly goals
-   **Recommendations**: AI-generated suggestions for improvement

### 5. Progressive Planning

-   **Week Completion**: After 7 days, users can generate analysis
-   **Next Week Generation**: Create new week based on previous performance
-   **Continuous Improvement**: Each week builds on the previous one

## API Endpoints

### Weekly Todo Management

-   `POST /api/weekly-todos/generate` - Generate new weekly todo list
-   `GET /api/weekly-todos/current` - Get current active week todo
-   `GET /api/weekly-todos/` - Get all weekly todos for user
-   `GET /api/weekly-todos/:todoId` - Get specific weekly todo

### Task Management

-   `PUT /api/weekly-todos/:todoId/items/:itemId` - Update todo item (mark complete/incomplete)

### Analysis

-   `GET /api/weekly-todos/:todoId/analysis` - Generate weekly analysis

## Data Models

### WeeklyTodo

```go
type WeeklyTodo struct {
    ID              primitive.ObjectID
    UserID          primitive.ObjectID
    WeekStartDate   time.Time
    WeekEndDate     time.Time
    WeekNumber      int
    UserProfile     UserProfile
    WeeklyGoals     []WeeklyGoal
    DailyTodos      []DailyTodo
    GeneratedAt     time.Time
    Status          string // "active", "completed", "expired"
    CompletionRate  float64
    PreviousWeekID  *primitive.ObjectID
}
```

### DailyTodo

```go
type DailyTodo struct {
    Day             string
    Date            time.Time
    MealTodos       []TodoItem
    WorkoutTodos    []TodoItem
    HealthTodos     []TodoItem
    LifestyleTodos  []TodoItem
    CompletedCount  int
    TotalCount      int
    CompletionRate  float64
}
```

### TodoItem

```go
type TodoItem struct {
    ID          primitive.ObjectID
    Title       string
    Description string
    Category    string // "meal", "workout", "health", "lifestyle"
    Priority    string // "high", "medium", "low"
    Timing      string // "morning", "afternoon", "evening", "anytime"
    IsCompleted bool
    CompletedAt *time.Time
    Notes       string
}
```

## Usage Flow

### 1. Initial Setup

1. User completes onboarding with health goals and preferences
2. System generates first weekly todo list
3. Todos are saved to database with "active" status

### 2. Daily Usage

1. User views current week's todos
2. Marks tasks as complete throughout the day
3. System updates completion rates in real-time

### 3. Week Completion

1. After 7 days, user can generate weekly analysis
2. System provides performance insights and recommendations
3. User can generate next week's todos based on analysis

### 4. Progressive Planning

1. Next week's todos consider previous week's performance
2. Difficulty and focus areas adjusted based on completion rates
3. Continuous improvement cycle

## Example Todo Items

### Daily Structure (4 todos per day):

**Monday Example:**

-   **Meal:** "Swap white rice with quinoa for lunch" (high priority, lunch timing)
-   **Workout:** "30-minute brisk walking" (medium priority, morning timing)
-   **Health:** "Drink 8 glasses of water" (high priority, anytime timing)
-   **Lifestyle:** "Get 7-8 hours of sleep" (high priority, evening timing)

**Tuesday Example:**

-   **Meal:** "Use stevia instead of sugar in tea" (high priority, anytime timing)
-   **Workout:** "10-minute stretching routine" (low priority, evening timing)
-   **Health:** "Take vitamin D supplement" (high priority, morning timing)
-   **Lifestyle:** "Practice 5 minutes of deep breathing" (medium priority, anytime timing)

### Sample Weekly Goals:

-   Reduce sugar intake by 50% this week
-   Complete 5 workout sessions
-   Maintain 7-8 hours of sleep daily
-   Check blood sugar levels 3 times this week

## Technical Implementation

### Services

-   `WeeklyTodoService`: Core business logic for todo management
-   `Gemini Integration`: AI-powered todo generation
-   `Database Operations`: MongoDB for data persistence

### Controllers

-   `WeeklyTodoController`: API endpoint handlers
-   `Authentication`: JWT-based user authentication
-   `Validation`: Request validation and error handling

### Routes

-   RESTful API design
-   Protected endpoints with authentication middleware
-   Clear URL structure for easy frontend integration

## Benefits

1. **Actionable**: Specific, checkable tasks instead of general advice
2. **Personalized**: Tailored to individual health goals and preferences
3. **Trackable**: Clear progress monitoring and completion rates
4. **Adaptive**: Each week improves based on previous performance
5. **Sustainable**: Focus on building lasting habits
6. **Engaging**: Todo format encourages daily engagement

**Response:**

```json
{
    "success": true,
    "message": "Weekly todo list generated and saved successfully",
    "data": {
        "id": "507f1f77bcf86cd799439011",
        "user_id": "507f1f77bcf86cd799439012",
        "week_start_date": "2024-01-15T00:00:00Z",
        "week_end_date": "2024-01-21T00:00:00Z",
        "week_number": 2800,
        "status": "active",
        "completion_rate": 0.0,
        "weekly_goals": [
            {
                "category": "nutrition",
                "description": "Reduce sugar intake by 50%",
                "target": "Max 25g sugar per day",
                "measurable": true,
                "completed": false
            }
        ],
        "daily_todos": [
            {
                "day": "Monday",
                "date": "2024-01-15T00:00:00Z",
                "meal_todos": [
                    {
                        "id": "507f1f77bcf86cd799439013",
                        "title": "Swap white rice with quinoa",
                        "description": "Replace white rice with quinoa for lunch to reduce glycemic index",
                        "category": "meal",
                        "priority": "high",
                        "timing": "lunch",
                        "is_completed": false
                    }
                ],
                "workout_todos": [
                    {
                        "id": "507f1f77bcf86cd799439014",
                        "title": "30-minute brisk walking",
                        "description": "Go for a brisk walk to improve cardiovascular health",
                        "category": "workout",
                        "priority": "medium",
                        "timing": "morning",
                        "is_completed": false
                    }
                ],
                "health_todos": [
                    {
                        "id": "507f1f77bcf86cd799439015",
                        "title": "Drink 8 glasses of water",
                        "description": "Stay hydrated throughout the day",
                        "category": "health",
                        "priority": "high",
                        "timing": "anytime",
                        "is_completed": false
                    }
                ],
                "lifestyle_todos": [
                    {
                        "id": "507f1f77bcf86cd799439016",
                        "title": "Get 7-8 hours of sleep",
                        "description": "Ensure adequate sleep for better health",
                        "category": "lifestyle",
                        "priority": "high",
                        "timing": "evening",
                        "is_completed": false
                    }
                ]
            }
        ]
    }
}
```
